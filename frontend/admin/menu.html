<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men√∫ Principal - Admin - RHM</title>
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <div class="container">
        <div class="menu-card">
            <!-- Header -->
            <div class="card-header">
                <button class="btn-back" onclick="volver()">‚Üê</button>
                <div class="header-content">
                    <div class="header-icon">üìã</div>
                    <h1>Men√∫ Principal</h1>
                </div>
            </div>

            <!-- Men√∫ de opciones -->
            <div class="menu-options">
                <button class="menu-btn" onclick="irA('asistencia')">
                    <div class="menu-btn-icon">üìä</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Asistencia</div>
                        <div class="menu-btn-description">Ver y gestionar registros de asistencia</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('empleados')">
                    <div class="menu-btn-icon">üë•</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Empleados</div>
                        <div class="menu-btn-description">Gestionar empleados y descuentos</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('sueldos')">
                    <div class="menu-btn-icon">üí∞</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Sueldos</div>
                        <div class="menu-btn-description">Calcular y gestionar sueldos</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('vacaciones')">
                    <div class="menu-btn-icon">üèñÔ∏è</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Vacaciones</div>
                        <div class="menu-btn-description">Gestionar vacaciones de empleados</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('pagos')">
                    <div class="menu-btn-icon">üí≥</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Pagos</div>
                        <div class="menu-btn-description">Historial de pagos realizados</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('uniformes')">
                    <div class="menu-btn-icon">üëî</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Uniformes y Botas</div>
                        <div class="menu-btn-description">Control de entregas</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('induccion')">
                    <div class="menu-btn-icon">üìö</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Inducci√≥n y Cursos</div>
                        <div class="menu-btn-description">Lista de empleados con cargos</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>

                <button class="menu-btn" onclick="irA('bonos-geocycle')">
                    <div class="menu-btn-icon">üéØ</div>
                    <div class="menu-btn-content">
                        <div class="menu-btn-title">Bonos GeoCycle</div>
                        <div class="menu-btn-description">Registro de producci√≥n y c√°lculo de bonos</div>
                    </div>
                    <div class="menu-btn-arrow">‚Üí</div>
                </button>
            </div>
        </div>
    </div>

    <script src="../js/theme.js"></script>
    <script src="../js/config.js"></script>
    <script>
        // Verificar cortes autom√°ticos al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            await verificarCortesAutomaticos();
        });

        // Verificar y mostrar alertas de cortes autom√°ticos
        async function verificarCortesAutomaticos() {
            try {
                const apiURL = window.API_CONFIG ? window.API_CONFIG.getBaseURL() : 'http://localhost:3000';
                const response = await fetch(`${apiURL}/api/cortes-automaticos/pendientes`);
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    // Mostrar alerta para cada corte autom√°tico
                    for (const corte of data.data) {
                        await mostrarAlertaCorte(corte);
                    }
                }
            } catch (error) {
                console.error('Error al verificar cortes autom√°ticos:', error);
            }
        }

        // Mostrar alerta de corte autom√°tico
        async function mostrarAlertaCorte(corte) {
            const nombreEmpleado = `${corte.nombre} ${corte.apellido}`;
            const fechaFormateada = corte.fecha;
            const horasExtra = corte.horas_extra.toFixed(2);

            const mensaje = `A ${nombreEmpleado} se le hizo corte autom√°tico el ${fechaFormateada}.\n\n` +
                          `Horas originales: ${corte.horas_originales.toFixed(2)}h\n` +
                          `Horas cortadas: ${corte.horas_cortadas.toFixed(2)}h\n` +
                          `Horas extra: ${horasExtra}h\n\n` +
                          `¬øQuieres mantener las ${horasExtra} horas extra?`;

            const respuesta = confirm(mensaje + '\n\nOK = S√≠, contabilizar horas extra\nCancelar = No, eliminar horas extra (solo 8 horas)');

            try {
                const apiURL = window.API_CONFIG ? window.API_CONFIG.getBaseURL() : 'http://localhost:3000';
                const accion = respuesta ? 'mantener' : 'eliminar';
                
                const response = await fetch(`${apiURL}/api/cortes-automaticos/${corte.id}/procesar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ accion: accion })
                });

                const data = await response.json();

                if (data.success) {
                    if (accion === 'mantener') {
                        alert(`‚úÖ Horas extra mantenidas para ${nombreEmpleado}\nSe contabilizar√°n ${corte.horas_cortadas.toFixed(2)} horas (8h normales + ${horasExtra}h extra)`);
                    } else {
                        alert(`‚úÖ Horas extra eliminadas para ${nombreEmpleado}\nSe contabilizar√°n solo 8 horas`);
                    }
                } else {
                    alert(`‚ùå Error: ${data.message}`);
                }
            } catch (error) {
                console.error('Error al procesar corte autom√°tico:', error);
                alert('‚ùå Error al procesar corte autom√°tico. Por favor, intenta de nuevo.');
            }
        }

        // Navegar a diferentes secciones
        function irA(seccion) {
            switch(seccion) {
                case 'asistencia':
                    window.location.href = 'asistencia.html';
                    break;
                case 'empleados':
                    window.location.href = 'empleados.html';
                    break;
                case 'sueldos':
                    window.location.href = 'sueldos.html';
                    break;
                case 'pagos':
                    window.location.href = 'pagos.html';
                    break;
                case 'uniformes':
                    window.location.href = 'uniformes.html';
                    break;
                case 'vacaciones':
                    window.location.href = 'vacaciones.html';
                    break;
                case 'induccion':
                    window.location.href = 'induccion.html';
                    break;
                case 'bonos-geocycle':
                    window.location.href = 'bonos-geocycle.html';
                    break;
                case 'nomina':
                    // window.location.href = 'nomina.html';
                    alert('Esta secci√≥n estar√° disponible pr√≥ximamente');
                    break;
                default:
                    console.error('Secci√≥n no reconocida:', seccion);
            }
        }

        // Volver al login
        function volver() {
            localStorage.removeItem('tipoUsuario');
            localStorage.removeItem('usuario');
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>

